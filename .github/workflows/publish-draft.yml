name: 'Build and Release'

on:
    push:
        tags:
            - "*"

jobs:
    build:
        name: Build (${{ matrix.os }} - ${{ matrix.arch }})
        runs-on: ${{ matrix.os }}
        strategy:
            matrix:
                os: [macOS-latestubuntu-latest, windows-latest]
                arch: [x64, arm64]
                include:
                -   os: windows-latest
                    arch: ia32
                -   os: ubuntu-latest
                    arch: arm64
                exclude:
                -   os: windows-latest
                    arch: arm64
        steps:
        -   uses: actions/checkout@v3
        -   name: Setup Node.js
            uses: actions/setup-node@v3
            with:
                node-version: 18.6.0
                cache: 'yarn'
        -   name: Install dependencies
            run: yarn
        -   name: Build application
            run: yarn run make --arch=${{ matrix.arch }}
        -   name: Create release draft
            uses: softprops/action-gh-release@v1
            env:
                GITHUB_TOKEN: ${{ secrets.PUBLISH_TOKEN }}
            with:
                draft: true
                files: |
                    out/**/*.deb
                    out/**/*.dmg
                    out/**/*setup*.exe
                    out/**/*.nupkg
                    out/**/*.rpm
                    out/**/*.zip
                    out/**/RELEASES








# jobs:
#     publish-squirrel-x64:
#         name: Publish (Squirrel Windows x64)
#         runs-on: windows-latest
#         env:
#             GITHUB_TOKEN: ${{ secrets.PUBLISH_TOKEN }}
#         steps:
#             - name: Checkout
#               uses: actions/checkout@v3

#             - name: Install Nodejs
#               uses: actions/setup-node@v3
#               with:
#                 node-version: 18.6.0
#                 cache: 'yarn'

#             - name: Install dependencies
#               run: yarn

#             - name: Publish
#               run: yarn run publish
#     publish-debian-arm64:
#         name: Publish (Debian ARM64)
#         runs-on: ubuntu-latest
#         env:
#             GITHUB_TOKEN: ${{ secrets.PUBLISH_TOKEN }}
#         steps:
#             - name: Checkout
#               uses: actions/checkout@v3

#             - name: Install Nodejs
#               uses: actions/setup-node@v3
#               with:
#                 node-version: 18.6.0
#                 cache: 'yarn'

#             - name: Install dependencies
#               run: yarn

#             - name: Publish
#               run: yarn run publish --arch=arm64